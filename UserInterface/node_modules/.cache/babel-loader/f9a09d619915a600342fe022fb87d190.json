{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar base_1 = require(\"./base\");\n\nvar Url = __importStar(require(\"url\"));\n\nfunction isRelativeUrl(url) {\n  var u = Url.parse(url);\n  return u.protocol === null && u.host === null && u.port === null;\n}\n\nfunction isSameOrigin(a, b) {\n  var ua = Url.parse(a);\n  var ub = Url.parse(b); // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n\n  return ua.protocol === ub.protocol && ua.hostname === ub.hostname && ua.port === ub.port;\n}\n\nvar BrowserImage =\n/** @class */\nfunction (_super) {\n  __extends(BrowserImage, _super);\n\n  function BrowserImage() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  BrowserImage.prototype._initCanvas = function () {\n    var img = this.image;\n    var canvas = this._canvas = document.createElement('canvas');\n    var context = this._context = canvas.getContext('2d');\n    canvas.className = 'vibrant-canvas';\n    canvas.style.display = 'none';\n    this._width = canvas.width = img.width;\n    this._height = canvas.height = img.height;\n    context.drawImage(img, 0, 0);\n    document.body.appendChild(canvas);\n  };\n\n  BrowserImage.prototype.load = function (image) {\n    var _this = this;\n\n    var img = null;\n    var src = null;\n\n    if (typeof image === 'string') {\n      img = document.createElement('img');\n\n      if (!isRelativeUrl(image) && !isSameOrigin(window.location.href, image)) {\n        img.crossOrigin = 'anonymous';\n      }\n\n      src = img.src = image;\n    } else if (image instanceof HTMLImageElement) {\n      img = image;\n      src = image.src;\n    } else {\n      return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n    }\n\n    this.image = img;\n    return new Promise(function (resolve, reject) {\n      var onImageLoad = function () {\n        _this._initCanvas();\n\n        resolve(_this);\n      };\n\n      if (img.complete) {\n        // Already loaded\n        onImageLoad();\n      } else {\n        img.onload = onImageLoad;\n\n        img.onerror = function (e) {\n          return reject(new Error(\"Fail to load image: \" + src));\n        };\n      }\n    });\n  };\n\n  BrowserImage.prototype.clear = function () {\n    this._context.clearRect(0, 0, this._width, this._height);\n  };\n\n  BrowserImage.prototype.update = function (imageData) {\n    this._context.putImageData(imageData, 0, 0);\n  };\n\n  BrowserImage.prototype.getWidth = function () {\n    return this._width;\n  };\n\n  BrowserImage.prototype.getHeight = function () {\n    return this._height;\n  };\n\n  BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n    var _a = this,\n        canvas = _a._canvas,\n        context = _a._context,\n        img = _a.image;\n\n    this._width = canvas.width = targetWidth;\n    this._height = canvas.height = targetHeight;\n    context.scale(ratio, ratio);\n    context.drawImage(img, 0, 0);\n  };\n\n  BrowserImage.prototype.getPixelCount = function () {\n    return this._width * this._height;\n  };\n\n  BrowserImage.prototype.getImageData = function () {\n    return this._context.getImageData(0, 0, this._width, this._height);\n  };\n\n  BrowserImage.prototype.remove = function () {\n    if (this._canvas && this._canvas.parentNode) {\n      this._canvas.parentNode.removeChild(this._canvas);\n    }\n  };\n\n  return BrowserImage;\n}(base_1.ImageBase);\n\nexports.default = BrowserImage;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;AACA;;AAEA,SAASA,aAAT,CAAwBC,GAAxB,EAAmC;EACjC,IAAIC,CAAC,GAAGC,GAAG,CAACC,KAAJ,CAAUH,GAAV,CAAR;EACA,OAAOC,CAAC,CAACG,QAAF,KAAe,IAAf,IACLH,CAAC,CAACI,IAAF,KAAW,IADN,IAELJ,CAAC,CAACK,IAAF,KAAW,IAFb;AAGD;;AAED,SAASC,YAAT,CAAuBC,CAAvB,EAAkCC,CAAlC,EAA2C;EACzC,IAAIC,EAAE,GAAGR,GAAG,CAACC,KAAJ,CAAUK,CAAV,CAAT;EACA,IAAIG,EAAE,GAAGT,GAAG,CAACC,KAAJ,CAAUM,CAAV,CAAT,CAFyC,CAIzC;;EACA,OAAOC,EAAE,CAACN,QAAH,KAAgBO,EAAE,CAACP,QAAnB,IACLM,EAAE,CAACE,QAAH,KAAgBD,EAAE,CAACC,QADd,IAELF,EAAE,CAACJ,IAAH,KAAYK,EAAE,CAACL,IAFjB;AAGD;;AAED;AAAA;AAAA;EAA0CO;;EAA1C;;EAqFC;;EA/ESC,qCAAR;IACE,IAAIC,GAAG,GAAG,KAAKC,KAAf;IACA,IAAIC,MAAM,GAAG,KAAKC,OAAL,GAAeC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAA5B;IACA,IAAIC,OAAO,GAAG,KAAKC,QAAL,GAAgBL,MAAM,CAACM,UAAP,CAAkB,IAAlB,CAA9B;IAEAN,MAAM,CAACO,SAAP,GAAmB,gBAAnB;IACAP,MAAM,CAACQ,KAAP,CAAaC,OAAb,GAAuB,MAAvB;IAEA,KAAKC,MAAL,GAAcV,MAAM,CAACW,KAAP,GAAeb,GAAG,CAACa,KAAjC;IACA,KAAKC,OAAL,GAAeZ,MAAM,CAACa,MAAP,GAAgBf,GAAG,CAACe,MAAnC;IAEAT,OAAQ,CAACU,SAAT,CAAmBhB,GAAnB,EAAwB,CAAxB,EAA2B,CAA3B;IAEAI,QAAQ,CAACa,IAAT,CAAcC,WAAd,CAA0BhB,MAA1B;EACD,CAdO;;EAeRH,wCAAME,KAAN,EAAwB;IAAxB;;IACE,IAAID,GAAG,GAA4B,IAAnC;IACA,IAAImB,GAAG,GAAkB,IAAzB;;IACA,IAAI,OAAOlB,KAAP,KAAiB,QAArB,EAA+B;MAC7BD,GAAG,GAAGI,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAN;;MACA,IAAI,CAACrB,aAAa,CAACiB,KAAD,CAAd,IAAyB,CAACT,YAAY,CAAC4B,MAAM,CAACC,QAAP,CAAgBC,IAAjB,EAAuBrB,KAAvB,CAA1C,EAAyE;QACvED,GAAG,CAACuB,WAAJ,GAAkB,WAAlB;MACD;;MACDJ,GAAG,GAAGnB,GAAG,CAACmB,GAAJ,GAAUlB,KAAhB;IACD,CAND,MAMO,IAAIA,KAAK,YAAYuB,gBAArB,EAAuC;MAC5CxB,GAAG,GAAGC,KAAN;MACAkB,GAAG,GAAGlB,KAAK,CAACkB,GAAZ;IACD,CAHM,MAGA;MACL,OAAOM,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,2CAAV,CAAf,CAAP;IACD;;IACD,KAAK1B,KAAL,GAAaD,GAAb;IAEA,OAAO,IAAIyB,OAAJ,CAAuB,UAACG,OAAD,EAAUF,MAAV,EAAgB;MAC5C,IAAIG,WAAW,GAAG;QAChBC,KAAI,CAACC,WAAL;;QACAH,OAAO,CAACE,KAAD,CAAP;MACD,CAHD;;MAKA,IAAI9B,GAAI,CAACgC,QAAT,EAAmB;QACjB;QACAH,WAAW;MACZ,CAHD,MAGO;QACL7B,GAAI,CAACiC,MAAL,GAAcJ,WAAd;;QACA7B,GAAI,CAACkC,OAAL,GAAe,UAACC,CAAD,EAAE;UAAK,aAAM,CAAC,IAAIR,KAAJ,CAAU,yBAAuBR,GAAjC,CAAD,CAAN;QAA+C,CAArE;MACD;IACF,CAbM,CAAP;EAcD,CA/BD;;EAgCApB;IACE,KAAKQ,QAAL,CAAc6B,SAAd,CAAwB,CAAxB,EAA2B,CAA3B,EAA8B,KAAKxB,MAAnC,EAA2C,KAAKE,OAAhD;EACD,CAFD;;EAGAf,0CAAQsC,SAAR,EAA4B;IAC1B,KAAK9B,QAAL,CAAc+B,YAAd,CAA2BD,SAA3B,EAA6C,CAA7C,EAAgD,CAAhD;EACD,CAFD;;EAGAtC;IACE,OAAO,KAAKa,MAAZ;EACD,CAFD;;EAGAb;IACE,OAAO,KAAKe,OAAZ;EACD,CAFD;;EAGAf,0CAAQwC,WAAR,EAA6BC,YAA7B,EAAmDC,KAAnD,EAAgE;IAC1D,SAAqD,IAArD;IAAA,IAAWvC,MAAM,aAAjB;IAAA,IAA6BI,OAAO,cAApC;IAAA,IAA6CN,GAAG,WAAhD;;IAEJ,KAAKY,MAAL,GAAcV,MAAM,CAACW,KAAP,GAAe0B,WAA7B;IACA,KAAKzB,OAAL,GAAeZ,MAAM,CAACa,MAAP,GAAgByB,YAA/B;IAEAlC,OAAO,CAACoC,KAAR,CAAcD,KAAd,EAAqBA,KAArB;IACAnC,OAAO,CAACU,SAAR,CAAkBhB,GAAlB,EAAuB,CAAvB,EAA0B,CAA1B;EACD,CARD;;EASAD;IACE,OAAO,KAAKa,MAAL,GAAc,KAAKE,OAA1B;EACD,CAFD;;EAGAf;IACE,OAAO,KAAKQ,QAAL,CAAcoC,YAAd,CAA2B,CAA3B,EAA8B,CAA9B,EAAiC,KAAK/B,MAAtC,EAA8C,KAAKE,OAAnD,CAAP;EACD,CAFD;;EAGAf;IACE,IAAI,KAAKI,OAAL,IAAgB,KAAKA,OAAL,CAAayC,UAAjC,EAA6C;MAC3C,KAAKzC,OAAL,CAAayC,UAAb,CAAwBC,WAAxB,CAAoC,KAAK1C,OAAzC;IACD;EACF,CAJD;;EAKF;AAAC,CArFD,CAA0C2C,gBAA1C","names":["isRelativeUrl","url","u","Url","parse","protocol","host","port","isSameOrigin","a","b","ua","ub","hostname","__extends","BrowserImage","img","image","canvas","_canvas","document","createElement","context","_context","getContext","className","style","display","_width","width","_height","height","drawImage","body","appendChild","src","window","location","href","crossOrigin","HTMLImageElement","Promise","reject","Error","resolve","onImageLoad","_this","_initCanvas","complete","onload","onerror","e","clearRect","imageData","putImageData","targetWidth","targetHeight","ratio","scale","getImageData","parentNode","removeChild","base_1"],"sourceRoot":"","sources":["../../src/image/browser.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}