{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar util_1 = require(\"../util\");\n\nvar VBox =\n/** @class */\nfunction () {\n  function VBox(r1, r2, g1, g2, b1, b2, hist) {\n    this._volume = -1;\n    this._count = -1;\n    this.dimension = {\n      r1: r1,\n      r2: r2,\n      g1: g1,\n      g2: g2,\n      b1: b1,\n      b2: b2\n    };\n    this.hist = hist;\n  }\n\n  VBox.build = function (pixels, shouldIgnore) {\n    var hn = 1 << 3 * util_1.SIGBITS;\n    var hist = new Uint32Array(hn);\n    var rmax;\n    var rmin;\n    var gmax;\n    var gmin;\n    var bmax;\n    var bmin;\n    var r;\n    var g;\n    var b;\n    var a;\n    rmax = gmax = bmax = 0;\n    rmin = gmin = bmin = Number.MAX_VALUE;\n    var n = pixels.length / 4;\n    var i = 0;\n\n    while (i < n) {\n      var offset = i * 4;\n      i++;\n      r = pixels[offset + 0];\n      g = pixels[offset + 1];\n      b = pixels[offset + 2];\n      a = pixels[offset + 3]; // Ignored pixels' alpha is marked as 0 in filtering stage\n\n      if (a === 0) continue;\n      r = r >> util_1.RSHIFT;\n      g = g >> util_1.RSHIFT;\n      b = b >> util_1.RSHIFT;\n      var index = util_1.getColorIndex(r, g, b);\n      hist[index] += 1;\n      if (r > rmax) rmax = r;\n      if (r < rmin) rmin = r;\n      if (g > gmax) gmax = g;\n      if (g < gmin) gmin = g;\n      if (b > bmax) bmax = b;\n      if (b < bmin) bmin = b;\n    }\n\n    return new VBox(rmin, rmax, gmin, gmax, bmin, bmax, hist);\n  };\n\n  VBox.prototype.invalidate = function () {\n    this._volume = this._count = -1;\n    this._avg = null;\n  };\n\n  VBox.prototype.volume = function () {\n    if (this._volume < 0) {\n      var _a = this.dimension,\n          r1 = _a.r1,\n          r2 = _a.r2,\n          g1 = _a.g1,\n          g2 = _a.g2,\n          b1 = _a.b1,\n          b2 = _a.b2;\n      this._volume = (r2 - r1 + 1) * (g2 - g1 + 1) * (b2 - b1 + 1);\n    }\n\n    return this._volume;\n  };\n\n  VBox.prototype.count = function () {\n    if (this._count < 0) {\n      var hist = this.hist;\n      var _a = this.dimension,\n          r1 = _a.r1,\n          r2 = _a.r2,\n          g1 = _a.g1,\n          g2 = _a.g2,\n          b1 = _a.b1,\n          b2 = _a.b2;\n      var c = 0;\n\n      for (var r = r1; r <= r2; r++) {\n        for (var g = g1; g <= g2; g++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            c += hist[index];\n          }\n        }\n      }\n\n      this._count = c;\n    }\n\n    return this._count;\n  };\n\n  VBox.prototype.clone = function () {\n    var hist = this.hist;\n    var _a = this.dimension,\n        r1 = _a.r1,\n        r2 = _a.r2,\n        g1 = _a.g1,\n        g2 = _a.g2,\n        b1 = _a.b1,\n        b2 = _a.b2;\n    return new VBox(r1, r2, g1, g2, b1, b2, hist);\n  };\n\n  VBox.prototype.avg = function () {\n    if (!this._avg) {\n      var hist = this.hist;\n      var _a = this.dimension,\n          r1 = _a.r1,\n          r2 = _a.r2,\n          g1 = _a.g1,\n          g2 = _a.g2,\n          b1 = _a.b1,\n          b2 = _a.b2;\n      var ntot = 0;\n      var mult = 1 << 8 - util_1.SIGBITS;\n      var rsum = void 0;\n      var gsum = void 0;\n      var bsum = void 0;\n      rsum = gsum = bsum = 0;\n\n      for (var r = r1; r <= r2; r++) {\n        for (var g = g1; g <= g2; g++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            var h = hist[index];\n            ntot += h;\n            rsum += h * (r + 0.5) * mult;\n            gsum += h * (g + 0.5) * mult;\n            bsum += h * (b + 0.5) * mult;\n          }\n        }\n      }\n\n      if (ntot) {\n        this._avg = [~~(rsum / ntot), ~~(gsum / ntot), ~~(bsum / ntot)];\n      } else {\n        this._avg = [~~(mult * (r1 + r2 + 1) / 2), ~~(mult * (g1 + g2 + 1) / 2), ~~(mult * (b1 + b2 + 1) / 2)];\n      }\n    }\n\n    return this._avg;\n  };\n\n  VBox.prototype.contains = function (rgb) {\n    var r = rgb[0],\n        g = rgb[1],\n        b = rgb[2];\n    var _a = this.dimension,\n        r1 = _a.r1,\n        r2 = _a.r2,\n        g1 = _a.g1,\n        g2 = _a.g2,\n        b1 = _a.b1,\n        b2 = _a.b2;\n    r >>= util_1.RSHIFT;\n    g >>= util_1.RSHIFT;\n    b >>= util_1.RSHIFT;\n    return r >= r1 && r <= r2 && g >= g1 && g <= g2 && b >= b1 && b <= b2;\n  };\n\n  VBox.prototype.split = function () {\n    var hist = this.hist;\n    var _a = this.dimension,\n        r1 = _a.r1,\n        r2 = _a.r2,\n        g1 = _a.g1,\n        g2 = _a.g2,\n        b1 = _a.b1,\n        b2 = _a.b2;\n    var count = this.count();\n    if (!count) return [];\n    if (count === 1) return [this.clone()];\n    var rw = r2 - r1 + 1;\n    var gw = g2 - g1 + 1;\n    var bw = b2 - b1 + 1;\n    var maxw = Math.max(rw, gw, bw);\n    var accSum = null;\n    var sum;\n    var total;\n    sum = total = 0;\n    var maxd = null;\n\n    if (maxw === rw) {\n      maxd = 'r';\n      accSum = new Uint32Array(r2 + 1);\n\n      for (var r = r1; r <= r2; r++) {\n        sum = 0;\n\n        for (var g = g1; g <= g2; g++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            sum += hist[index];\n          }\n        }\n\n        total += sum;\n        accSum[r] = total;\n      }\n    } else if (maxw === gw) {\n      maxd = 'g';\n      accSum = new Uint32Array(g2 + 1);\n\n      for (var g = g1; g <= g2; g++) {\n        sum = 0;\n\n        for (var r = r1; r <= r2; r++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            sum += hist[index];\n          }\n        }\n\n        total += sum;\n        accSum[g] = total;\n      }\n    } else {\n      maxd = 'b';\n      accSum = new Uint32Array(b2 + 1);\n\n      for (var b = b1; b <= b2; b++) {\n        sum = 0;\n\n        for (var r = r1; r <= r2; r++) {\n          for (var g = g1; g <= g2; g++) {\n            var index = util_1.getColorIndex(r, g, b);\n            sum += hist[index];\n          }\n        }\n\n        total += sum;\n        accSum[b] = total;\n      }\n    }\n\n    var splitPoint = -1;\n    var reverseSum = new Uint32Array(accSum.length);\n\n    for (var i = 0; i < accSum.length; i++) {\n      var d = accSum[i];\n      if (splitPoint < 0 && d > total / 2) splitPoint = i;\n      reverseSum[i] = total - d;\n    }\n\n    var vbox = this;\n\n    function doCut(d) {\n      var dim1 = d + '1';\n      var dim2 = d + '2';\n      var d1 = vbox.dimension[dim1];\n      var d2 = vbox.dimension[dim2];\n      var vbox1 = vbox.clone();\n      var vbox2 = vbox.clone();\n      var left = splitPoint - d1;\n      var right = d2 - splitPoint;\n\n      if (left <= right) {\n        d2 = Math.min(d2 - 1, ~~(splitPoint + right / 2));\n        d2 = Math.max(0, d2);\n      } else {\n        d2 = Math.max(d1, ~~(splitPoint - 1 - left / 2));\n        d2 = Math.min(vbox.dimension[dim2], d2);\n      }\n\n      while (!accSum[d2]) {\n        d2++;\n      }\n\n      var c2 = reverseSum[d2];\n\n      while (!c2 && accSum[d2 - 1]) {\n        c2 = reverseSum[--d2];\n      }\n\n      vbox1.dimension[dim2] = d2;\n      vbox2.dimension[dim1] = d2 + 1;\n      return [vbox1, vbox2];\n    }\n\n    return doCut(maxd);\n  };\n\n  return VBox;\n}();\n\nexports.default = VBox;","map":{"version":3,"mappings":"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","names":["r1","r2","g1","g2","b1","b2","hist","dimension","VBox","pixels","shouldIgnore","hn","util_1","Uint32Array","rmax","rmin","gmax","gmin","bmax","bmin","r","g","b","a","Number","MAX_VALUE","n","length","i","offset","index","_volume","_count","_avg","c","ntot","mult","rsum","gsum","bsum","h","rgb","count","clone","rw","gw","bw","maxw","Math","max","accSum","sum","total","maxd","splitPoint","reverseSum","d","vbox","doCut","dim1","dim2","d1","d2","vbox1","vbox2","left","right","min","c2"],"sourceRoot":"","sources":["../../src/quantizer/vbox.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}