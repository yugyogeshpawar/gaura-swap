{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar _slicedToArray = require(\"/Users/vaibhav/Desktop/Home/Blockchain Boutique/Uniswap_forked_gaura/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"/Users/vaibhav/Desktop/Home/Blockchain Boutique/Uniswap_forked_gaura/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/vaibhav/Desktop/Home/Blockchain Boutique/Uniswap_forked_gaura/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"/Users/vaibhav/Desktop/Home/Blockchain Boutique/Uniswap_forked_gaura/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/vaibhav/Desktop/Home/Blockchain Boutique/Uniswap_forked_gaura/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletLinkRelay = void 0;\n\nvar bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\n\nvar eth_rpc_errors_1 = require(\"eth-rpc-errors\");\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar WalletLinkAnalytics_1 = require(\"../connection/WalletLinkAnalytics\");\n\nvar WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\n\nvar init_1 = require(\"../init\");\n\nvar util_1 = require(\"../util\");\n\nvar aes256gcm = __importStar(require(\"./aes256gcm\"));\n\nvar Session_1 = require(\"./Session\");\n\nvar WalletLinkRelayAbstract_1 = require(\"./WalletLinkRelayAbstract\");\n\nvar Web3Method_1 = require(\"./Web3Method\");\n\nvar Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\n\nvar Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\n\nvar Web3Response_1 = require(\"./Web3Response\");\n\nvar Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\n\nvar WalletLinkRelay = /*#__PURE__*/function (_WalletLinkRelayAbstr) {\n  _inherits(WalletLinkRelay, _WalletLinkRelayAbstr);\n\n  var _super = _createSuper(WalletLinkRelay);\n\n  function WalletLinkRelay(options) {\n    var _this;\n\n    _classCallCheck(this, WalletLinkRelay);\n\n    _this = _super.call(this);\n    _this.accountsCallback = null;\n    _this.chainCallback = null;\n    _this.appName = \"\";\n    _this.appLogoUrl = null;\n    _this.subscriptions = new rxjs_1.Subscription();\n    _this.walletLinkUrl = options.walletLinkUrl;\n    _this.storage = options.storage;\n    _this._session = Session_1.Session.load(options.storage) || new Session_1.Session(options.storage).save();\n    _this.relayEventManager = options.relayEventManager;\n    _this.walletLinkAnalytics = options.walletLinkAnalytics ? options.walletLinkAnalytics : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n    _this.connection = new WalletLinkConnection_1.WalletLinkConnection(_this._session.id, _this._session.key, _this.walletLinkUrl, _this.walletLinkAnalytics);\n\n    _this.subscriptions.add(_this.connection.incomingEvent$.pipe((0, operators_1.filter)(function (m) {\n      return m.event === \"Web3Response\";\n    })).subscribe({\n      next: _this.handleIncomingEvent\n    }) // eslint-disable-line @typescript-eslint/unbound-method\n    );\n\n    _this.subscriptions.add(_this.connection.linked$.pipe((0, operators_1.skip)(1), (0, operators_1.tap)(function (linked) {\n      var _a;\n\n      _this.isLinked = linked;\n\n      var cachedAddresses = _this.storage.getItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n\n      if (linked) {\n        // Only set linked session variable one way\n        _this.session.linked = linked;\n      }\n\n      _this.isUnlinkedErrorState = false;\n\n      if (cachedAddresses) {\n        var addresses = cachedAddresses.split(\" \");\n        var wasConnectedViaStandalone = _this.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n\n        if (addresses[0] !== \"\" && !linked && _this.session.linked && !wasConnectedViaStandalone) {\n          _this.isUnlinkedErrorState = true;\n\n          var sessionIdHash = _this.getSessionIdHash();\n\n          (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.UNLINKED_ERROR_STATE, {\n            sessionIdHash: sessionIdHash,\n            origin: location.origin\n          });\n        }\n      }\n    })).subscribe()); // if session is marked destroyed, reset and reload\n\n\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return !!c.metadata && c.metadata.__destroyed === \"1\";\n    })).subscribe(function () {\n      var _a;\n\n      var alreadyDestroyed = _this.connection.isDestroyed;\n      (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.METADATA_DESTROYED, {\n        alreadyDestroyed: alreadyDestroyed,\n        sessionIdHash: _this.getSessionIdHash(),\n        origin: location.origin\n      });\n      return _this.resetAndReload();\n    }));\n\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.WalletUsername !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return aes256gcm.decrypt(c.metadata.WalletUsername, _this._session.secret);\n    })).subscribe({\n      next: function next(walletUsername) {\n        _this.storage.setItem(WalletLinkRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n      },\n      error: function error() {\n        var _a;\n\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"username\"\n        });\n      }\n    }));\n\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.AppVersion !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return aes256gcm.decrypt(c.metadata.AppVersion, _this._session.secret);\n    })).subscribe({\n      next: function next(appVersion) {\n        _this.storage.setItem(WalletLinkRelayAbstract_1.APP_VERSION_KEY, appVersion);\n      },\n      error: function error() {\n        var _a;\n\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"appversion\"\n        });\n      }\n    }));\n\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.ChainId !== undefined && c.metadata.JsonRpcUrl !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, _this._session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, _this._session.secret));\n    })).pipe((0, operators_1.distinctUntilChanged)()).subscribe({\n      next: function next(_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            chainId = _ref2[0],\n            jsonRpcUrl = _ref2[1];\n\n        if (_this.chainCallback) {\n          _this.chainCallback(chainId, jsonRpcUrl);\n        }\n      },\n      error: function error() {\n        var _a;\n\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"chainId|jsonRpcUrl\"\n        });\n      }\n    }));\n\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.EthereumAddress !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return aes256gcm.decrypt(c.metadata.EthereumAddress, _this._session.secret);\n    })).subscribe({\n      next: function next(selectedAddress) {\n        if (_this.accountsCallback) {\n          _this.accountsCallback([selectedAddress]);\n        }\n\n        if (WalletLinkRelay.accountRequestCallbackIds.size > 0) {\n          // We get the ethereum address from the metadata.  If for whatever\n          // reason we don't get a response via an explicit web3 message\n          // we can still fulfill the eip1102 request.\n          Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n            var message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.RequestEthereumAccountsResponse)([selectedAddress])\n            });\n\n            _this.invokeCallback(Object.assign(Object.assign({}, message), {\n              id: id\n            }));\n          });\n          WalletLinkRelay.accountRequestCallbackIds.clear();\n        }\n      },\n      error: function error() {\n        var _a;\n\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"selectedAddress\"\n        });\n      }\n    }));\n\n    _this.ui = options.walletLinkUIConstructor({\n      walletLinkUrl: options.walletLinkUrl,\n      version: options.version,\n      darkMode: options.darkMode,\n      session: _this._session,\n      connected$: _this.connection.connected$\n    });\n\n    _this.connection.connect();\n\n    return _this;\n  }\n\n  _createClass(WalletLinkRelay, [{\n    key: \"attachUI\",\n    value: function attachUI() {\n      this.ui.attach();\n    }\n  }, {\n    key: \"resetAndReload\",\n    value: function resetAndReload() {\n      var _this2 = this;\n\n      this.connection.setSessionMetadata(\"__destroyed\", \"1\").pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(function (_) {\n        return (0, rxjs_1.of)(null);\n      })).subscribe(function (_) {\n        var _a, _b, _c;\n\n        try {\n          _this2.subscriptions.unsubscribe();\n        } catch (err) {\n          (_a = _this2.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error unsubscribing\"\n          });\n        }\n\n        (_b = _this2.walletLinkAnalytics) === null || _b === void 0 ? void 0 : _b.sendEvent(init_1.EVENTS.SESSION_STATE_CHANGE, {\n          method: \"relay::resetAndReload\",\n          sessionMetadataChange: \"__destroyed, 1\",\n          sessionIdHash: _this2.getSessionIdHash(),\n          origin: location.origin\n        });\n\n        _this2.connection.destroy();\n        /**\n         * Only clear storage if the session id we have in memory matches the one on disk\n         * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n         * storage already.  In that case if we clear storage again, the user will be in\n         * a state where the first tab allows the user to connect but the session that\n         * was used isn't persisted.  This leaves the user in a state where they aren't\n         * connected to the mobile app.\n         */\n\n\n        var storedSession = Session_1.Session.load(_this2.storage);\n\n        if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === _this2._session.id) {\n          _this2.storage.clear();\n        } else if (storedSession) {\n          (_c = _this2.walletLinkAnalytics) === null || _c === void 0 ? void 0 : _c.sendEvent(init_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n            sessionIdHash: _this2.getSessionIdHash(),\n            storedSessionIdHash: Session_1.Session.hash(storedSession.id),\n            origin: location.origin\n          });\n        }\n\n        _this2.ui.reloadUI();\n      }, function (err) {\n        var _a;\n\n        (_a = _this2.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.FAILURE, {\n          method: \"relay::resetAndReload\",\n          message: \"failed to reset and reload with \".concat(err),\n          sessionIdHash: _this2.getSessionIdHash()\n        });\n      });\n    }\n  }, {\n    key: \"setAppInfo\",\n    value: function setAppInfo(appName, appLogoUrl) {\n      this.appName = appName;\n      this.appLogoUrl = appLogoUrl;\n    }\n  }, {\n    key: \"getStorageItem\",\n    value: function getStorageItem(key) {\n      return this.storage.getItem(key);\n    }\n  }, {\n    key: \"session\",\n    get: function get() {\n      return this._session;\n    }\n  }, {\n    key: \"setStorageItem\",\n    value: function setStorageItem(key, value) {\n      this.storage.setItem(key, value);\n    }\n  }, {\n    key: \"signEthereumMessage\",\n    value: function signEthereumMessage(message, address, addPrefix, typedDataJson) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          address: address,\n          addPrefix: addPrefix,\n          typedDataJson: typedDataJson || null\n        }\n      });\n    }\n  }, {\n    key: \"ethereumAddressFromSignedMessage\",\n    value: function ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          signature: (0, util_1.hexStringFromBuffer)(signature, true),\n          addPrefix: addPrefix\n        }\n      });\n    }\n  }, {\n    key: \"signEthereumTransaction\",\n    value: function signEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxPriorityFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: false\n        }\n      });\n    }\n  }, {\n    key: \"signAndSubmitEthereumTransaction\",\n    value: function signAndSubmitEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.maxFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas) : null,\n          maxPriorityFeePerGas: params.maxPriorityFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: true\n        }\n      });\n    }\n  }, {\n    key: \"submitEthereumTransaction\",\n    value: function submitEthereumTransaction(signedTransaction, chainId) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.submitEthereumTransaction,\n        params: {\n          signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n          chainId: chainId\n        }\n      });\n    }\n  }, {\n    key: \"scanQRCode\",\n    value: function scanQRCode(regExp) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.scanQRCode,\n        params: {\n          regExp: regExp\n        }\n      });\n    }\n  }, {\n    key: \"genericRequest\",\n    value: function genericRequest(data, action) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.generic,\n        params: {\n          action: action,\n          data: data\n        }\n      });\n    }\n  }, {\n    key: \"sendGenericMessage\",\n    value: function sendGenericMessage(request) {\n      return this.sendRequest(request);\n    }\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(request) {\n      var _this3 = this;\n\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel() {\n        _this3.publishWeb3RequestCanceledEvent(id);\n\n        _this3.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      var promise = new Promise(function (resolve, reject) {\n        if (!_this3.ui.isStandalone()) {\n          hideSnackbarItem = _this3.ui.showConnecting({\n            isUnlinkedErrorState: _this3.isUnlinkedErrorState,\n            onCancel: cancel,\n            onResetConnection: _this3.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n          });\n        }\n\n        _this3.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        if (_this3.ui.isStandalone()) {\n          _this3.sendRequestStandalone(id, request);\n        } else {\n          _this3.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"setConnectDisabled\",\n    value: function setConnectDisabled(disabled) {\n      this.ui.setConnectDisabled(disabled);\n    }\n  }, {\n    key: \"setAccountsCallback\",\n    value: function setAccountsCallback(accountsCallback) {\n      this.accountsCallback = accountsCallback;\n    }\n  }, {\n    key: \"setChainCallback\",\n    value: function setChainCallback(chainCallback) {\n      this.chainCallback = chainCallback;\n    }\n  }, {\n    key: \"publishWeb3RequestEvent\",\n    value: function publishWeb3RequestEvent(id, request) {\n      var _this4 = this;\n\n      var _a;\n\n      var message = (0, Web3RequestMessage_1.Web3RequestMessage)({\n        id: id,\n        request: request\n      });\n      var storedSession = Session_1.Session.load(this.storage);\n      (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST, {\n        eventId: message.id,\n        method: \"relay::\".concat(message.request.method),\n        sessionIdHash: this.getSessionIdHash(),\n        storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n        isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n        origin: location.origin\n      });\n      this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n        next: function next(_) {\n          var _a;\n\n          (_a = _this4.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n            eventId: message.id,\n            method: \"relay::\".concat(message.request.method),\n            sessionIdHash: _this4.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== _this4._session.id).toString(),\n            origin: location.origin\n          });\n        },\n        error: function error(err) {\n          _this4.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: message.id,\n            response: {\n              method: message.request.method,\n              errorMessage: err.message\n            }\n          }));\n        }\n      }));\n    }\n  }, {\n    key: \"publishWeb3RequestCanceledEvent\",\n    value: function publishWeb3RequestCanceledEvent(id) {\n      var message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n      this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n  }, {\n    key: \"publishEvent\",\n    value: function publishEvent(event, message, callWebhook) {\n      var _this5 = this;\n\n      var secret = this.session.secret;\n      return new rxjs_1.Observable(function (subscriber) {\n        void aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), {\n          origin: location.origin\n        })), secret).then(function (encrypted) {\n          subscriber.next(encrypted);\n          subscriber.complete();\n        });\n      }).pipe((0, operators_1.mergeMap)(function (encrypted) {\n        return _this5.connection.publishEvent(event, encrypted, callWebhook);\n      }));\n    }\n  }, {\n    key: \"handleIncomingEvent\",\n    value: function handleIncomingEvent(event) {\n      var _this6 = this;\n\n      try {\n        this.subscriptions.add(aes256gcm.decrypt(event.data, this.session.secret).pipe((0, operators_1.map)(function (c) {\n          return JSON.parse(c);\n        })).subscribe({\n          next: function next(json) {\n            var message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n\n            if (!message) {\n              return;\n            }\n\n            _this6.handleWeb3ResponseMessage(message);\n          },\n          error: function error() {\n            var _a;\n\n            (_a = _this6.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n              message: \"Had error decrypting\",\n              value: \"incomingEvent\"\n            });\n          }\n        }));\n      } catch (_a) {\n        return;\n      }\n    }\n  }, {\n    key: \"handleWeb3ResponseMessage\",\n    value: function handleWeb3ResponseMessage(message) {\n      var _this7 = this;\n\n      var _a;\n\n      var response = message.response;\n      (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_RESPONSE, {\n        eventId: message.id,\n        method: \"relay::\".concat(response.method),\n        sessionIdHash: this.getSessionIdHash(),\n        origin: location.origin\n      });\n\n      if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n        Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n          return _this7.invokeCallback(Object.assign(Object.assign({}, message), {\n            id: id\n          }));\n        });\n        WalletLinkRelay.accountRequestCallbackIds.clear();\n        return;\n      }\n\n      this.invokeCallback(message);\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(message) {\n      var callback = this.relayEventManager.callbacks.get(message.id);\n\n      if (callback) {\n        callback(message.response);\n        this.relayEventManager.callbacks.delete(message.id);\n      }\n    }\n  }, {\n    key: \"requestEthereumAccounts\",\n    value: function requestEthereumAccounts() {\n      var _this8 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.requestEthereumAccounts,\n        params: {\n          appName: this.appName,\n          appLogoUrl: this.appLogoUrl || null\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel() {\n        _this8.publishWeb3RequestCanceledEvent(id);\n\n        _this8.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      var promise = new Promise(function (resolve, reject) {\n        var _a;\n\n        _this8.relayEventManager.callbacks.set(id, function (response) {\n          _this8.ui.hideRequestEthereumAccounts();\n\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n\n        if (userAgent && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n          window.location.href = \"https://go.cb-w.com/xoXnYwQimhb?cb_url=\".concat(encodeURIComponent(window.location.href));\n          return;\n        }\n\n        if (_this8.ui.inlineAccountsResponse()) {\n          var onAccounts = function onAccounts(accounts) {\n            _this8.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts)\n            }));\n          };\n\n          _this8.ui.requestEthereumAccounts({\n            onCancel: cancel,\n            onAccounts: onAccounts\n          });\n        } else {\n          _this8.ui.requestEthereumAccounts({\n            onCancel: cancel\n          });\n        }\n\n        WalletLinkRelay.accountRequestCallbackIds.add(id);\n\n        if (!_this8.ui.inlineAccountsResponse() && !_this8.ui.isStandalone()) {\n          _this8.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"watchAsset\",\n    value: function watchAsset(type, address, symbol, decimals, image) {\n      var _this9 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.watchAsset,\n        params: {\n          type: type,\n          options: {\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image\n          }\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel() {\n        _this9.publishWeb3RequestCanceledEvent(id);\n\n        _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      if (!this.ui.inlineWatchAsset()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this9.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel() {\n          _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(false)\n          }));\n        };\n\n        var approve = function approve() {\n          _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(true)\n          }));\n        };\n\n        if (_this9.ui.inlineWatchAsset()) {\n          _this9.ui.watchAsset({\n            onApprove: approve,\n            onCancel: _cancel,\n            type: type,\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image\n          });\n        }\n\n        if (!_this9.ui.inlineWatchAsset() && !_this9.ui.isStandalone()) {\n          _this9.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        cancel: cancel,\n        promise: promise\n      };\n    }\n  }, {\n    key: \"addEthereumChain\",\n    value: function addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n      var _this10 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.addEthereumChain,\n        params: {\n          chainId: chainId,\n          rpcUrls: rpcUrls,\n          blockExplorerUrls: blockExplorerUrls,\n          chainName: chainName,\n          iconUrls: iconUrls,\n          nativeCurrency: nativeCurrency\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel() {\n        _this10.publishWeb3RequestCanceledEvent(id);\n\n        _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      if (!this.ui.inlineAddEthereumChain(chainId)) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this10.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel() {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: false,\n              rpcUrl: \"\"\n            })\n          }));\n        };\n\n        var approve = function approve(rpcUrl) {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n\n        if (_this10.ui.inlineAddEthereumChain(chainId)) {\n          _this10.ui.addEthereumChain({\n            onCancel: _cancel,\n            onApprove: approve,\n            chainId: request.params.chainId,\n            rpcUrls: request.params.rpcUrls,\n            blockExplorerUrls: request.params.blockExplorerUrls,\n            chainName: request.params.chainName,\n            iconUrls: request.params.iconUrls,\n            nativeCurrency: request.params.nativeCurrency\n          });\n        }\n\n        if (!_this10.ui.inlineAddEthereumChain(chainId) && !_this10.ui.isStandalone()) {\n          _this10.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"switchEthereumChain\",\n    value: function switchEthereumChain(chainId) {\n      var _this11 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.switchEthereumChain,\n        params: {\n          chainId: chainId\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel() {\n        _this11.publishWeb3RequestCanceledEvent(id);\n\n        _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      if (!this.ui.inlineSwitchEthereumChain()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this11.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage && response.errorCode) {\n            return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n              code: response.errorCode,\n              message: \"Unrecognized chain ID. Try adding the chain using addEthereumChain first.\"\n            }));\n          } else if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel(errorCode) {\n          if (errorCode) {\n            _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, \"unsupported chainId\", errorCode)\n            }));\n          } else {\n            _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                isApproved: false,\n                rpcUrl: \"\"\n              })\n            }));\n          }\n        };\n\n        var approve = function approve(rpcUrl) {\n          _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n\n        _this11.ui.switchEthereumChain({\n          onCancel: _cancel,\n          onApprove: approve,\n          chainId: request.params.chainId\n        });\n\n        if (!_this11.ui.inlineSwitchEthereumChain() && !_this11.ui.isStandalone()) {\n          _this11.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"getSessionIdHash\",\n    value: function getSessionIdHash() {\n      return Session_1.Session.hash(this._session.id);\n    }\n  }, {\n    key: \"sendRequestStandalone\",\n    value: function sendRequestStandalone(id, request) {\n      var _this12 = this;\n\n      var _cancel = function _cancel() {\n        _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n      };\n\n      var onSuccess = function onSuccess(response) {\n        _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: response\n        }));\n      };\n\n      switch (request.method) {\n        case Web3Method_1.Web3Method.signEthereumMessage:\n          this.ui.signEthereumMessage({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n\n        case Web3Method_1.Web3Method.signEthereumTransaction:\n          this.ui.signEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n\n        case Web3Method_1.Web3Method.submitEthereumTransaction:\n          this.ui.submitEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n\n        case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n          this.ui.ethereumAddressFromSignedMessage({\n            request: request,\n            onSuccess: onSuccess\n          });\n          break;\n\n        default:\n          _cancel();\n\n          break;\n      }\n    }\n  }]);\n\n  return WalletLinkRelay;\n}(WalletLinkRelayAbstract_1.WalletLinkRelayAbstract);\n\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"resetAndReload\", null);\n\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\n\nexports.WalletLinkRelay = WalletLinkRelay;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","WalletLinkRelay","bind_decorator_1","require","eth_rpc_errors_1","rxjs_1","operators_1","WalletLinkAnalytics_1","WalletLinkConnection_1","init_1","util_1","aes256gcm","Session_1","WalletLinkRelayAbstract_1","Web3Method_1","Web3RequestCanceledMessage_1","Web3RequestMessage_1","Web3Response_1","Web3ResponseMessage_1","options","accountsCallback","chainCallback","appName","appLogoUrl","subscriptions","Subscription","walletLinkUrl","storage","_session","Session","load","save","relayEventManager","walletLinkAnalytics","WalletLinkAnalytics","connection","WalletLinkConnection","id","add","incomingEvent$","pipe","filter","event","subscribe","next","handleIncomingEvent","linked$","skip","tap","linked","_a","isLinked","cachedAddresses","getItem","LOCAL_STORAGE_ADDRESSES_KEY","session","isUnlinkedErrorState","addresses","split","wasConnectedViaStandalone","sessionIdHash","getSessionIdHash","sendEvent","EVENTS","UNLINKED_ERROR_STATE","origin","location","sessionConfig$","metadata","__destroyed","alreadyDestroyed","isDestroyed","METADATA_DESTROYED","resetAndReload","WalletUsername","mergeMap","decrypt","secret","walletUsername","setItem","WALLET_USER_NAME_KEY","error","GENERAL_ERROR","message","AppVersion","appVersion","APP_VERSION_KEY","ChainId","JsonRpcUrl","zip","distinctUntilChanged","chainId","jsonRpcUrl","EthereumAddress","selectedAddress","accountRequestCallbackIds","size","Array","from","values","forEach","Web3ResponseMessage","response","RequestEthereumAccountsResponse","invokeCallback","assign","clear","ui","walletLinkUIConstructor","version","darkMode","connected$","connect","attach","setSessionMetadata","timeout","catchError","_","of","_b","_c","unsubscribe","err","SESSION_STATE_CHANGE","method","sessionMetadataChange","destroy","storedSession","SKIPPED_CLEARING_SESSION","storedSessionIdHash","hash","reloadUI","FAILURE","address","addPrefix","typedDataJson","sendRequest","Web3Method","signEthereumMessage","params","hexStringFromBuffer","signature","ethereumAddressFromSignedMessage","signEthereumTransaction","fromAddress","toAddress","weiValue","bigIntStringFromBN","data","nonce","gasPriceInWei","maxFeePerGas","maxPriorityFeePerGas","gasLimit","shouldSubmit","signedTransaction","submitEthereumTransaction","regExp","scanQRCode","action","generic","request","hideSnackbarItem","randomBytesHex","cancel","publishWeb3RequestCanceledEvent","handleWeb3ResponseMessage","ErrorResponse","promise","Promise","resolve","reject","isStandalone","showConnecting","onCancel","onResetConnection","callbacks","set","errorMessage","Error","sendRequestStandalone","publishWeb3RequestEvent","disabled","setConnectDisabled","Web3RequestMessage","WEB3_REQUEST","eventId","isSessionMismatched","toString","publishEvent","WEB3_REQUEST_PUBLISHED","Web3RequestCanceledMessage","callWebhook","Observable","subscriber","encrypt","JSON","stringify","then","encrypted","complete","map","parse","json","isWeb3ResponseMessage","WEB3_RESPONSE","isRequestEthereumAccountsResponse","callback","delete","requestEthereumAccounts","hideRequestEthereumAccounts","userAgent","window","navigator","test","href","encodeURIComponent","inlineAccountsResponse","onAccounts","accounts","type","symbol","decimals","image","watchAsset","inlineWatchAsset","_cancel","WatchAssetReponse","approve","onApprove","rpcUrls","iconUrls","blockExplorerUrls","chainName","nativeCurrency","addEthereumChain","inlineAddEthereumChain","AddEthereumChainResponse","isApproved","rpcUrl","switchEthereumChain","inlineSwitchEthereumChain","errorCode","ethErrors","provider","custom","code","SwitchEthereumChainResponse","onSuccess","WalletLinkRelayAbstract","Set","default"],"sources":["/Users/vaibhav/Desktop/Home/Blockchain Boutique/Uniswap_forked_gaura/node_modules/walletlink/dist/relay/WalletLinkRelay.js"],"sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletLinkRelay = void 0;\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst WalletLinkAnalytics_1 = require(\"../connection/WalletLinkAnalytics\");\nconst WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\nconst init_1 = require(\"../init\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst WalletLinkRelayAbstract_1 = require(\"./WalletLinkRelayAbstract\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nclass WalletLinkRelay extends WalletLinkRelayAbstract_1.WalletLinkRelayAbstract {\n    constructor(options) {\n        super();\n        this.accountsCallback = null;\n        this.chainCallback = null;\n        this.appName = \"\";\n        this.appLogoUrl = null;\n        this.subscriptions = new rxjs_1.Subscription();\n        this.walletLinkUrl = options.walletLinkUrl;\n        this.storage = options.storage;\n        this._session =\n            Session_1.Session.load(options.storage) || new Session_1.Session(options.storage).save();\n        this.relayEventManager = options.relayEventManager;\n        this.walletLinkAnalytics = options.walletLinkAnalytics\n            ? options.walletLinkAnalytics\n            : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n        this.connection = new WalletLinkConnection_1.WalletLinkConnection(this._session.id, this._session.key, this.walletLinkUrl, this.walletLinkAnalytics);\n        this.subscriptions.add(this.connection.incomingEvent$\n            .pipe((0, operators_1.filter)(m => m.event === \"Web3Response\"))\n            .subscribe({ next: this.handleIncomingEvent }) // eslint-disable-line @typescript-eslint/unbound-method\n        );\n        this.subscriptions.add(this.connection.linked$\n            .pipe((0, operators_1.skip)(1), (0, operators_1.tap)((linked) => {\n            var _a;\n            this.isLinked = linked;\n            const cachedAddresses = this.storage.getItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n            if (linked) {\n                // Only set linked session variable one way\n                this.session.linked = linked;\n            }\n            this.isUnlinkedErrorState = false;\n            if (cachedAddresses) {\n                const addresses = cachedAddresses.split(\" \");\n                const wasConnectedViaStandalone = this.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n                if (addresses[0] !== \"\" &&\n                    !linked &&\n                    this.session.linked &&\n                    !wasConnectedViaStandalone) {\n                    this.isUnlinkedErrorState = true;\n                    const sessionIdHash = this.getSessionIdHash();\n                    (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.UNLINKED_ERROR_STATE, { sessionIdHash, origin: location.origin });\n                }\n            }\n        }))\n            .subscribe());\n        // if session is marked destroyed, reset and reload\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => !!c.metadata && c.metadata.__destroyed === \"1\"))\n            .subscribe(() => {\n            var _a;\n            const alreadyDestroyed = this.connection.isDestroyed;\n            (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.METADATA_DESTROYED, {\n                alreadyDestroyed,\n                sessionIdHash: this.getSessionIdHash(),\n                origin: location.origin\n            });\n            return this.resetAndReload();\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.WalletUsername !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.WalletUsername, this._session.secret)))\n            .subscribe({\n            next: walletUsername => {\n                this.storage.setItem(WalletLinkRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"username\"\n                });\n            }\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.AppVersion !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.AppVersion, this._session.secret)))\n            .subscribe({\n            next: appVersion => {\n                this.storage.setItem(WalletLinkRelayAbstract_1.APP_VERSION_KEY, appVersion);\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"appversion\"\n                });\n            }\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata &&\n            c.metadata.ChainId !== undefined &&\n            c.metadata.JsonRpcUrl !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, this._session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, this._session.secret))))\n            .pipe((0, operators_1.distinctUntilChanged)())\n            .subscribe({\n            next: ([chainId, jsonRpcUrl]) => {\n                if (this.chainCallback) {\n                    this.chainCallback(chainId, jsonRpcUrl);\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"chainId|jsonRpcUrl\"\n                });\n            }\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.EthereumAddress !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.EthereumAddress, this._session.secret)))\n            .subscribe({\n            next: selectedAddress => {\n                if (this.accountsCallback) {\n                    this.accountsCallback([selectedAddress]);\n                }\n                if (WalletLinkRelay.accountRequestCallbackIds.size > 0) {\n                    // We get the ethereum address from the metadata.  If for whatever\n                    // reason we don't get a response via an explicit web3 message\n                    // we can still fulfill the eip1102 request.\n                    Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => {\n                        const message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                            id,\n                            response: (0, Web3Response_1.RequestEthereumAccountsResponse)([\n                                selectedAddress\n                            ])\n                        });\n                        this.invokeCallback(Object.assign(Object.assign({}, message), { id }));\n                    });\n                    WalletLinkRelay.accountRequestCallbackIds.clear();\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"selectedAddress\"\n                });\n            }\n        }));\n        this.ui = options.walletLinkUIConstructor({\n            walletLinkUrl: options.walletLinkUrl,\n            version: options.version,\n            darkMode: options.darkMode,\n            session: this._session,\n            connected$: this.connection.connected$\n        });\n        this.connection.connect();\n    }\n    attachUI() {\n        this.ui.attach();\n    }\n    resetAndReload() {\n        this.connection\n            .setSessionMetadata(\"__destroyed\", \"1\")\n            .pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(_ => (0, rxjs_1.of)(null)))\n            .subscribe(_ => {\n            var _a, _b, _c;\n            try {\n                this.subscriptions.unsubscribe();\n            }\n            catch (err) {\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error unsubscribing\"\n                });\n            }\n            (_b = this.walletLinkAnalytics) === null || _b === void 0 ? void 0 : _b.sendEvent(init_1.EVENTS.SESSION_STATE_CHANGE, {\n                method: \"relay::resetAndReload\",\n                sessionMetadataChange: \"__destroyed, 1\",\n                sessionIdHash: this.getSessionIdHash(),\n                origin: location.origin\n            });\n            this.connection.destroy();\n            /**\n             * Only clear storage if the session id we have in memory matches the one on disk\n             * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n             * storage already.  In that case if we clear storage again, the user will be in\n             * a state where the first tab allows the user to connect but the session that\n             * was used isn't persisted.  This leaves the user in a state where they aren't\n             * connected to the mobile app.\n             */\n            const storedSession = Session_1.Session.load(this.storage);\n            if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === this._session.id) {\n                this.storage.clear();\n            }\n            else if (storedSession) {\n                (_c = this.walletLinkAnalytics) === null || _c === void 0 ? void 0 : _c.sendEvent(init_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: Session_1.Session.hash(storedSession.id),\n                    origin: location.origin\n                });\n            }\n            this.ui.reloadUI();\n        }, (err) => {\n            var _a;\n            (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.FAILURE, {\n                method: \"relay::resetAndReload\",\n                message: `failed to reset and reload with ${err}`,\n                sessionIdHash: this.getSessionIdHash()\n            });\n        });\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.appName = appName;\n        this.appLogoUrl = appLogoUrl;\n    }\n    getStorageItem(key) {\n        return this.storage.getItem(key);\n    }\n    get session() {\n        return this._session;\n    }\n    setStorageItem(key, value) {\n        this.storage.setItem(key, value);\n    }\n    signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                address,\n                addPrefix,\n                typedDataJson: typedDataJson || null\n            }\n        });\n    }\n    ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                signature: (0, util_1.hexStringFromBuffer)(signature, true),\n                addPrefix\n            }\n        });\n    }\n    signEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxPriorityFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: false\n            }\n        });\n    }\n    signAndSubmitEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.maxFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas)\n                    : null,\n                maxPriorityFeePerGas: params.maxPriorityFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: true\n            }\n        });\n    }\n    submitEthereumTransaction(signedTransaction, chainId) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.submitEthereumTransaction,\n            params: {\n                signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n                chainId\n            }\n        });\n    }\n    scanQRCode(regExp) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.scanQRCode,\n            params: { regExp }\n        });\n    }\n    genericRequest(data, action) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.generic,\n            params: {\n                action,\n                data\n            }\n        });\n    }\n    sendGenericMessage(request) {\n        return this.sendRequest(request);\n    }\n    sendRequest(request) {\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            if (!this.ui.isStandalone()) {\n                hideSnackbarItem = this.ui.showConnecting({\n                    isUnlinkedErrorState: this.isUnlinkedErrorState,\n                    onCancel: cancel,\n                    onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n                });\n            }\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            if (this.ui.isStandalone()) {\n                this.sendRequestStandalone(id, request);\n            }\n            else {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    setConnectDisabled(disabled) {\n        this.ui.setConnectDisabled(disabled);\n    }\n    setAccountsCallback(accountsCallback) {\n        this.accountsCallback = accountsCallback;\n    }\n    setChainCallback(chainCallback) {\n        this.chainCallback = chainCallback;\n    }\n    publishWeb3RequestEvent(id, request) {\n        var _a;\n        const message = (0, Web3RequestMessage_1.Web3RequestMessage)({ id, request });\n        const storedSession = Session_1.Session.load(this.storage);\n        (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST, {\n            eventId: message.id,\n            method: `relay::${message.request.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n            origin: location.origin\n        });\n        this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n            next: _ => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n                    eventId: message.id,\n                    method: `relay::${message.request.method}`,\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: storedSession\n                        ? Session_1.Session.hash(storedSession.id)\n                        : \"\",\n                    isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n                    origin: location.origin\n                });\n            },\n            error: err => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id: message.id,\n                    response: {\n                        method: message.request.method,\n                        errorMessage: err.message\n                    }\n                }));\n            }\n        }));\n    }\n    publishWeb3RequestCanceledEvent(id) {\n        const message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n        this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n    publishEvent(event, message, callWebhook) {\n        const secret = this.session.secret;\n        return new rxjs_1.Observable(subscriber => {\n            void aes256gcm\n                .encrypt(JSON.stringify(Object.assign(Object.assign({}, message), { origin: location.origin })), secret)\n                .then((encrypted) => {\n                subscriber.next(encrypted);\n                subscriber.complete();\n            });\n        }).pipe((0, operators_1.mergeMap)((encrypted) => {\n            return this.connection.publishEvent(event, encrypted, callWebhook);\n        }));\n    }\n    handleIncomingEvent(event) {\n        try {\n            this.subscriptions.add(aes256gcm\n                .decrypt(event.data, this.session.secret)\n                .pipe((0, operators_1.map)(c => JSON.parse(c)))\n                .subscribe({\n                next: json => {\n                    const message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n                    if (!message) {\n                        return;\n                    }\n                    this.handleWeb3ResponseMessage(message);\n                },\n                error: () => {\n                    var _a;\n                    (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                        message: \"Had error decrypting\",\n                        value: \"incomingEvent\"\n                    });\n                }\n            }));\n        }\n        catch (_a) {\n            return;\n        }\n    }\n    handleWeb3ResponseMessage(message) {\n        var _a;\n        const { response } = message;\n        (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_RESPONSE, {\n            eventId: message.id,\n            method: `relay::${response.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n            origin: location.origin\n        });\n        if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n            Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), { id })));\n            WalletLinkRelay.accountRequestCallbackIds.clear();\n            return;\n        }\n        this.invokeCallback(message);\n    }\n    invokeCallback(message) {\n        const callback = this.relayEventManager.callbacks.get(message.id);\n        if (callback) {\n            callback(message.response);\n            this.relayEventManager.callbacks.delete(message.id);\n        }\n    }\n    requestEthereumAccounts() {\n        let request = {\n            method: Web3Method_1.Web3Method.requestEthereumAccounts,\n            params: {\n                appName: this.appName,\n                appLogoUrl: this.appLogoUrl || null\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            var _a;\n            this.relayEventManager.callbacks.set(id, response => {\n                this.ui.hideRequestEthereumAccounts();\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n            if (userAgent &&\n                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n                window.location.href = `https://go.cb-w.com/xoXnYwQimhb?cb_url=${encodeURIComponent(window.location.href)}`;\n                return;\n            }\n            if (this.ui.inlineAccountsResponse()) {\n                const onAccounts = (accounts) => {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts)\n                    }));\n                };\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel,\n                    onAccounts\n                });\n            }\n            else {\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel\n                });\n            }\n            WalletLinkRelay.accountRequestCallbackIds.add(id);\n            if (!this.ui.inlineAccountsResponse() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    watchAsset(type, address, symbol, decimals, image) {\n        const request = {\n            method: Web3Method_1.Web3Method.watchAsset,\n            params: {\n                type,\n                options: {\n                    address,\n                    symbol,\n                    decimals,\n                    image\n                }\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineWatchAsset()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(false)\n                }));\n            };\n            const approve = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(true)\n                }));\n            };\n            if (this.ui.inlineWatchAsset()) {\n                this.ui.watchAsset({\n                    onApprove: approve,\n                    onCancel: _cancel,\n                    type,\n                    address,\n                    symbol,\n                    decimals,\n                    image\n                });\n            }\n            if (!this.ui.inlineWatchAsset() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { cancel, promise };\n    }\n    addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n        let request = {\n            method: Web3Method_1.Web3Method.addEthereumChain,\n            params: {\n                chainId,\n                rpcUrls,\n                blockExplorerUrls,\n                chainName,\n                iconUrls,\n                nativeCurrency\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineAddEthereumChain(chainId)) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({\n                        isApproved: false,\n                        rpcUrl: \"\"\n                    })\n                }));\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({ isApproved: true, rpcUrl })\n                }));\n            };\n            if (this.ui.inlineAddEthereumChain(chainId)) {\n                this.ui.addEthereumChain({\n                    onCancel: _cancel,\n                    onApprove: approve,\n                    chainId: request.params.chainId,\n                    rpcUrls: request.params.rpcUrls,\n                    blockExplorerUrls: request.params\n                        .blockExplorerUrls,\n                    chainName: request.params.chainName,\n                    iconUrls: request.params.iconUrls,\n                    nativeCurrency: request.params\n                        .nativeCurrency\n                });\n            }\n            if (!this.ui.inlineAddEthereumChain(chainId) && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    switchEthereumChain(chainId) {\n        let request = {\n            method: Web3Method_1.Web3Method.switchEthereumChain,\n            params: {\n                chainId\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineSwitchEthereumChain()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage && response.errorCode) {\n                    return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n                        code: response.errorCode,\n                        message: `Unrecognized chain ID. Try adding the chain using addEthereumChain first.`\n                    }));\n                }\n                else if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (errorCode) => {\n                if (errorCode) {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, \"unsupported chainId\", errorCode)\n                    }));\n                }\n                else {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                            isApproved: false,\n                            rpcUrl: \"\"\n                        })\n                    }));\n                }\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                        isApproved: true,\n                        rpcUrl\n                    })\n                }));\n            };\n            this.ui.switchEthereumChain({\n                onCancel: _cancel,\n                onApprove: approve,\n                chainId: request.params.chainId\n            });\n            if (!this.ui.inlineSwitchEthereumChain() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    getSessionIdHash() {\n        return Session_1.Session.hash(this._session.id);\n    }\n    sendRequestStandalone(id, request) {\n        const _cancel = () => {\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n        };\n        const onSuccess = (response) => {\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response\n            }));\n        };\n        switch (request.method) {\n            case Web3Method_1.Web3Method.signEthereumMessage:\n                this.ui.signEthereumMessage({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel\n                });\n                break;\n            case Web3Method_1.Web3Method.signEthereumTransaction:\n                this.ui.signEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel\n                });\n                break;\n            case Web3Method_1.Web3Method.submitEthereumTransaction:\n                this.ui.submitEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel\n                });\n                break;\n            case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n                this.ui.ethereumAddressFromSignedMessage({\n                    request,\n                    onSuccess\n                });\n                break;\n            default:\n                _cancel();\n                break;\n        }\n    }\n}\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"resetAndReload\", null);\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletLinkRelay = WalletLinkRelay;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}