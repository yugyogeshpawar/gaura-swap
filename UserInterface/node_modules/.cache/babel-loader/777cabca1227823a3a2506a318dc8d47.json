{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar color_1 = require(\"../color\");\n\nvar vbox_1 = __importDefault(require(\"./vbox\"));\n\nvar pqueue_1 = __importDefault(require(\"./pqueue\"));\n\nvar fractByPopulations = 0.75;\n\nfunction _splitBoxes(pq, target) {\n  var lastSize = pq.size();\n\n  while (pq.size() < target) {\n    var vbox = pq.pop();\n\n    if (vbox && vbox.count() > 0) {\n      var _a = vbox.split(),\n          vbox1 = _a[0],\n          vbox2 = _a[1];\n\n      pq.push(vbox1);\n      if (vbox2 && vbox2.count() > 0) pq.push(vbox2); // No more new boxes, converged\n\n      if (pq.size() === lastSize) {\n        break;\n      } else {\n        lastSize = pq.size();\n      }\n    } else {\n      break;\n    }\n  }\n}\n\nvar MMCQ = function (pixels, opts) {\n  if (pixels.length === 0 || opts.colorCount < 2 || opts.colorCount > 256) {\n    throw new Error('Wrong MMCQ parameters');\n  }\n\n  var vbox = vbox_1.default.build(pixels);\n  var hist = vbox.hist;\n  var colorCount = Object.keys(hist).length;\n  var pq = new pqueue_1.default(function (a, b) {\n    return a.count() - b.count();\n  });\n  pq.push(vbox); // first set of colors, sorted by population\n\n  _splitBoxes(pq, fractByPopulations * opts.colorCount); // Re-order\n\n\n  var pq2 = new pqueue_1.default(function (a, b) {\n    return a.count() * a.volume() - b.count() * b.volume();\n  });\n  pq2.contents = pq.contents; // next set - generate the median cuts using the (npix * vol) sorting.\n\n  _splitBoxes(pq2, opts.colorCount - pq2.size()); // calculate the actual colors\n\n\n  return generateSwatches(pq2);\n};\n\nfunction generateSwatches(pq) {\n  var swatches = [];\n\n  while (pq.size()) {\n    var v = pq.pop();\n    var color = v.avg();\n    var r = color[0],\n        g = color[1],\n        b = color[2];\n    swatches.push(new color_1.Swatch(color, v.count()));\n  }\n\n  return swatches;\n}\n\nexports.default = MMCQ;","map":{"version":3,"mappings":"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","names":["fractByPopulations","_splitBoxes","pq","target","lastSize","size","vbox","pop","count","split","vbox1","vbox2","push","MMCQ","pixels","opts","length","colorCount","Error","vbox_1","build","hist","Object","keys","pqueue_1","a","b","pq2","volume","contents","generateSwatches","swatches","v","color","avg","g","color_1","exports"],"sourceRoot":"","sources":["../../src/quantizer/mmcq.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}